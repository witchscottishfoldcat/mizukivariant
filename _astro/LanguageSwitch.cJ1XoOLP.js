const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["_astro/translation.BEYOwJ1L.js","_astro/config.BNwZDY95.js","_astro/zh_TW.ORda0UXz.js"])))=>i.map(i=>d[i]);
import{_ as D}from"./preload-helper.BlTxHScW.js";import{s as k}from"./lifecycle.DavBjZBb.js";import{x as X,y,z as G,A as J,h as C,d as P,e as p,t as N,o as B,a as T,p as Q,b as U,s as z,g as i,B as q,r as h}from"./utils.DJr-jBEw.js";import{s as Y}from"./render.DfBNuYju.js";import{e as Z,i as I}from"./each.CrZuCW-W.js";import"./config.BNwZDY95.js";import"./zh_TW.ORda0UXz.js";import{I as W}from"./Icon.3ByRVZCK.js";import"./if.C1JizXau.js";import"./props.C0ApMCPi.js";function K(v,m){C(m,!i(m))}var ee=(v,m,b)=>m(i(b).code),te=P("<button><!> <span> </span></button>"),ne=P('<div class="language-switch-container relative z-50"><button aria-label="Language Switch" class="relative btn-plain scale-animation rounded-lg h-11 w-11 active:scale-90" id="language-switch"><div class="flex items-center justify-center"><!></div></button> <div role="menu" tabindex="-1"></div></div>');function me(v,m){U(m,!0);const b=[{code:"en",name:"English"},{code:"zh_CN",name:"简体中文"}];function H(){if(typeof window<"u"&&window.__currentLanguage)return console.log("LanguageSwitch: 使用全局变量语言",window.__currentLanguage),window.__currentLanguage;const o=localStorage.getItem("language")||"en";return console.log("LanguageSwitch: 使用localStorage语言",o),o}let f=y(G(H())),g=y(!1);function M(o){console.log("LanguageSwitch: 切换语言到",o),C(f,o,!0),localStorage.setItem("language",o),console.log("LanguageSwitch: 已设置localStorage",localStorage.getItem("language")),typeof window<"u"&&(window.__currentLanguage=o,console.log("LanguageSwitch: 已设置全局变量",window.__currentLanguage));const a=`language=${o}; path=/; max-age=${3600*24*365}; SameSite=Lax; Secure=false`;document.cookie=a,console.log("LanguageSwitch: 已设置Cookie",a),console.log("LanguageSwitch: 当前所有Cookie",document.cookie);const t=document.cookie.split(";").find(e=>e.trim().startsWith("language="));console.log("LanguageSwitch: Cookie验证",t),setTimeout(()=>{const e=document.cookie.split(";").find(l=>l.trim().startsWith("language="));console.log("LanguageSwitch: 延迟验证Cookie",e),(!e||!e.includes(o))&&(console.error("LanguageSwitch: Cookie设置失败！","期望:",o,"实际:",e),document.cookie=a,console.log("LanguageSwitch: 重试设置Cookie"))},50),document.documentElement.lang=o,console.log("LanguageSwitch: 已设置HTML lang属性",document.documentElement.lang),typeof window<"u"&&(window.dispatchEvent(new CustomEvent("language-changed",{detail:{lang:o}})),console.log("LanguageSwitch: 已触发 language-changed 事件")),j(),O(),console.log("LanguageSwitch: 语言切换完成，已更新所有文本（不刷新页面）")}function O(){const o=i(f);console.log("LanguageSwitch: 更新页面文本，语言:",o),D(async()=>{const{getTranslation:a}=await import("./translation.BEYOwJ1L.js");return{getTranslation:a}},__vite__mapDeps([0,1,2])).then(({getTranslation:a})=>{D(async()=>{const{default:t}=await import("./zh_TW.ORda0UXz.js").then(e=>e.i);return{default:t}},[]).then(({default:t})=>{const e=a(o);document.querySelectorAll("[data-i18n]").forEach(u=>{const n=u.getAttribute("data-i18n");n&&e[n]&&(u.textContent=e[n])});const s=document.querySelector('widget-layout[data-id="categories"]');if(s){const u=s.querySelector(".font-bold");u&&e[t.categories]&&(u.textContent=e[t.categories])}const c=document.querySelector('widget-layout[data-id="tags"]');if(c){const u=c.querySelector(".font-bold");u&&e[t.tags]&&(u.textContent=e[t.tags])}const r=document.querySelector('widget-layout[data-id="announcement"]');if(r){const u=r.querySelector(".font-bold");u&&e[t.announcement]&&(u.textContent=e[t.announcement]);const n=r.querySelector("button[aria-label]");n&&e[t.announcementClose]&&n.setAttribute("aria-label",e[t.announcementClose])}document.querySelectorAll(".expand-btn button").forEach(u=>{const n=document.createTreeWalker(u,NodeFilter.SHOW_TEXT,null);let d;for(;d=n.nextNode();){const _=d.textContent?.trim();if(_&&(_.toLowerCase().includes("more")||_==="更多"||_===e[t.more]||["More","更多","もっと","Más","Mehr"].some(R=>_===R))&&e[t.more]){d.textContent=e[t.more];break}}}),document.querySelectorAll("widget-layout").forEach(u=>{const n=u.querySelector(".font-bold");if(n){const d=u.getAttribute("data-id");d==="categories"&&e[t.categories]?n.textContent=e[t.categories]:d==="tags"&&e[t.tags]?n.textContent=e[t.tags]:d==="announcement"&&e[t.announcement]&&(n.textContent=e[t.announcement])}}),console.log("LanguageSwitch: 页面文本更新完成")})}).catch(a=>{console.error("LanguageSwitch: 无法加载翻译模块",a)})}function j(){const o=i(f);console.log("LanguageSwitch: 更新导航栏文本，语言:",o);const a={Home:{en:"Home",zh_CN:"主页"},About:{en:"About",zh_CN:"关于"},Archive:{en:"Archive",zh_CN:"归档"},Friends:{en:"Friends",zh_CN:"友链"},Anime:{en:"Anime",zh_CN:"追番"},Diary:{en:"Diary",zh_CN:"日记"},Albums:{en:"Albums",zh_CN:"相册"},Projects:{en:"Projects",zh_CN:"项目"},Skills:{en:"Skills",zh_CN:"技能"},Timeline:{en:"Timeline",zh_CN:"时间线"}},t=(e,l,s,c)=>{const r=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,null);let F;for(;F=r.nextNode();){const u=F.textContent?.trim();if(u===l||u===s)return F.textContent=c,!0}const x=e.querySelectorAll("span");for(const u of x){const n=u.textContent?.trim();if(n===l||n===s)return u.textContent=c,!0}return!1};for(const[e,l]of Object.entries(a)){const s=l[o]||l.en,c=l.en,r=l.zh_CN;document.querySelectorAll("#navbar button, #navbar a").forEach(n=>{(n.textContent?.trim().includes(c)||n.textContent?.trim().includes(r))&&t(n,c,r,s)}),document.querySelectorAll("#nav-menu-panel button, #nav-menu-panel a").forEach(n=>{(n.textContent?.trim().includes(c)||n.textContent?.trim().includes(r))&&t(n,c,r,s)}),document.querySelectorAll(".dropdown-item").forEach(n=>{(n.textContent?.trim().includes(c)||n.textContent?.trim().includes(r))&&t(n,c,r,s)})}console.log("LanguageSwitch: 导航栏文本更新完成")}function $(){switch(i(f)){case"en":return"flag:us-1";case"zh_CN":return"flag:cn-1";default:return"flag:us-1"}}typeof window<"u"&&J(()=>{document.documentElement.lang=i(f)}),typeof document<"u"&&document.addEventListener("click",o=>{o.target.closest(".language-switch-container")||C(g,!1)});var S=ne(),w=p(S);w.__click=[K,g];var A=p(w),V=p(A);{let o=q($);W(V,{get icon(){return i(o)},class:"text-[1.25rem]"})}h(A),h(w);var E=z(w,2);let L;Z(E,21,()=>b,I,(o,a)=>{var t=te();let e;t.__click=[ee,M,a];var l=p(t);{let r=q(()=>i(a).code==="en"?"flag:us-1":"flag:cn-1");W(l,{get icon(){return i(r)},class:"text-[1rem]"})}var s=z(l,2),c=p(s,!0);h(s),h(t),N(r=>{e=k(t,1,"w-full text-left px-4 py-2 text-sm hover:bg-[var(--hover-bg)] first:rounded-t-lg last:rounded-b-lg flex items-center gap-2",null,e,r),Y(c,i(a).name)},[()=>({"bg-[var(--hover-bg)]":i(f)===i(a).code})]),T(o,t)}),h(E),h(S),N(o=>L=k(E,1,"absolute right-0 mt-2 w-40 rounded-lg shadow-lg bg-[var(--card-bg)] border border-[var(--border-color)] transition-all duration-200 z-50",null,L,o),[()=>({"opacity-0":!i(g),invisible:!i(g),"opacity-100":i(g),visible:i(g)})]),B("mouseenter",w,()=>C(g,!0)),B("mouseleave",E,()=>C(g,!1)),B("mouseenter",E,()=>C(g,!0)),T(v,S),Q()}X(["click"]);export{me as default};
